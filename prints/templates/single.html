{% extends "base.html" %}{% load static %}

{% block title %}{{ print.title }}{% endblock %}

{% block content %}
<div class="row">
    <h3 class="brown-text print-title margin-b-20">{{ print.title }}</h3>
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-6 col-xl-6">
        <div class="row margin-b-30 text-center" id="title-img-container">
            {% if print.title_page %}
            <img src="{% static print.title_page.static %}" alt="Strona tytułowa" class="title-img">
            {% if user.is_authenticated %}
            <span onclick="javascript:show_dropzone()" class="change-title">Zmień stronę tytułową</span>
            {% endif %}
            {% else %}
            {% if user.is_authenticated %}
            <span onclick="javascript:show_dropzone()" class="default-title-page" style="background-image: url({% static "img/add.png" %})">
                <img src="{% static default_title_page %}" alt="(Brak strony tytułowej)" class="title-img" />
            </span>
            {% else %}
                <img src="{% static default_title_page %}" alt="(Brak strony tytułowej)" class="title-img" />
            {% endif %}
            {% endif %}
        </div>
        <hr />
        <div class="row">
            <p class="title-page">{% if print.title_page_content %}{{ print.title_page_content }}{% else %}<i>(brak)</i>{% endif %}</p>
        </div>
    </div>
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-6 col-xl-6 padding-r-30">
        <div class="row">
            <ul class="keywords">
                {% for keyword in print.key_words %}
                    <li class="keyword">
                        <a href="{% url "prints:collection" %}?keywords__contains={{ keyword }}" class="keyword">{{ keyword }}</a>
                    </li>
                {% endfor %}
            </ul>

            <ul class="print-info">
                <li class="info-item">
                    <div class="info-label">Tytuł:</div>
                    <div class="info-data">{{ print.title }}</div>
                </li>
                <li class="info-item">
                    <div class="info-label">Autor:</div>
                    <div class="info-data">{{ print.author }}</div>
                </li>
                <li class="info-item">
                    <div class="info-label">Data wydania:</div>
                    <div class="info-data">{{ print.date }}</div>
                </li>
                <li class="info-item">
                    <div class="info-label">Miejsce wydania:</div>
                    <div class="info-data">{{ print.place }}</div>
                </li>
                <li class="info-item">
                    <div class="info-label">Wydawca:</div><div class="info-data">{{ print.publisher }}</div>
                </li>
                <li class="info-item">
                    <div class="info-label">Sygnatura:</div>
                    <div class="info-data">{{ print.signature }}</div>
                </li>
            </ul>
            <div class="button-box">
                <a href="{% url "prints:view" print.id %}" class="brown-btn">Zobacz całość</a>
                {% if user.is_authenticated %}
                <a href="{% url "management:edit" print.id %}" class="brown-btn margin-l-15">Edytuj informacje</a>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <ul class="share">
                <li class="share">
                    <a href="http://www.facebook.com/share.php?u={{ request.build_absolute_uri }}" class="fa fa-facebook share"></a>
                </li>
                <li class="share">
                    <a href="https://twitter.com/intent/tweet?button_hashtag=TwitterStories" class="fa fa-twitter share"></a>
                </li>
                <!--<li class="share">-->
                    <!--<a href="" class="fa fa-google-plus share"></a>-->
                <!--</li>-->
                <li class="share">
                    <a href="mailto:?body={{ request.build_absolute_uri }}" class="fa fa-envelope share"></a>
                </li>
            </ul>
        </div>
    </div>
</div>
{% if user.is_authenticated %}
<div class="overlay-page" id="drop-title-page">
    <div id="title-page-dropzone" class="dropzone-box">
        <div onclick="$('#drop-title-page').hide();" class="close-btn"></div>
        <div class="dropzone-text">
            Przeciągnij i upuść zdjęcie, albo kliknij i wyszukaj...
        </div>
    </div>
</div>
{% endif %}
{% endblock %}


{% block extra_script %}
{% if user.is_authenticated %}
<script src="{% static "js/dropzone.js" %}"></script>
<script>


var title_box_content = '<img src="{% static "" %}{path}?{timestamp}" alt="Strona tytułowa" class="title-img"><span onclick="javascript:show_dropzone()" class="change-title">Zmień stronę tytułową</span>';

var titlePageDropzone = new Dropzone('#title-page-dropzone', {
    maxFilesize: 100, // MB
    maxFiles: 1,

    url: "{% url "management:upload_title_page" print.id %}",
    success: function(e, response){
        $('#drop-title-page').hide();
        $('#title-img-container').html(title_box_content.replace('{path}', response).replace('{timestamp}', new Date().getTime()));
    },
    error: function(e, err_msg, response){
        $('#drop-title-page').hide();
        alert('wystąpił błąd podczas ładowania, odśwież stronę i spróbuj jeszcze raz');
    },
    headers: {
        'X-CSRFToken': '{{ csrf_token }}'
    }
})


$('#drop-title-page').click(function(e){
    $('#drop-title-page').hide();
}).children().click(function(e) {return false;});

$(document).keyup(function(e) {
     if (e.keyCode == 27) {
        $('#drop-title-page').hide();
    }
});

show_dropzone = function(){
    titlePageDropzone.removeAllFiles();
    $('#drop-title-page').show();
};

</script>
{% endif %}
{% endblock %}
